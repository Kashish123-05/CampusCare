{% extends 'base.html' %}

{% block content %}
<h3 class="mb-4 fw-bold">Admin Dashboard</h3>

<div class="row mb-4 g-3">
    <div class="col-md-3">
        <div class="card h-100" onclick="window.openCampusAssistant&&openCampusAssistant()" style="cursor:pointer;background:linear-gradient(135deg,#fce7f3 0%,#f9a8d4 100%);border:none;transition:transform 0.2s" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
            <div class="card-body d-flex align-items-center">
                <div class="feature-icon ai me-2"><i class="bi bi-robot"></i></div>
                <div>
                    <h6 class="mb-0 fw-bold">AI Assistant</h6>
                    <small class="text-muted">Open chat</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card h-100" style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);">
            <div class="card-body">
                <h6 class="card-title"><i class="bi bi-collection me-1"></i>Total Issues</h6>
                <p class="display-6 mb-0">{{ total }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card pending h-100">
            <div class="card-body">
                <h6 class="card-title"><i class="bi bi-clock me-1"></i>Pending</h6>
                <p class="display-6 mb-0">{{ pending }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card in-progress h-100">
            <div class="card-body">
                <h6 class="card-title"><i class="bi bi-arrow-repeat me-1"></i>In Progress</h6>
                <p class="display-6 mb-0">{{ in_progress }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card resolved h-100">
            <div class="card-body">
                <h6 class="card-title"><i class="bi bi-check-circle me-1"></i>Resolved</h6>
                <p class="display-6 mb-0">{{ resolved }}</p>
            </div>
        </div>
    </div>
</div>

<form class="row g-2 mb-3" method="get">
    <div class="col-auto">
        <select name="category" class="form-select form-select-sm">
            <option value="">All Categories</option>
            <option value="electrical" {% if request.GET.category == 'electrical' %}selected{% endif %}>Electrical</option>
            <option value="plumbing" {% if request.GET.category == 'plumbing' %}selected{% endif %}>Plumbing</option>
            <option value="network" {% if request.GET.category == 'network' %}selected{% endif %}>Network</option>
            <option value="cleanliness" {% if request.GET.category == 'cleanliness' %}selected{% endif %}>Cleanliness</option>
            <option value="classroom_equipment" {% if request.GET.category == 'classroom_equipment' %}selected{% endif %}>Classroom Equipment</option>
            <option value="other" {% if request.GET.category == 'other' %}selected{% endif %}>Other</option>
        </select>
    </div>
    <div class="col-auto">
        <select name="priority" class="form-select form-select-sm">
            <option value="">All Priorities</option>
            <option value="low" {% if request.GET.priority == 'low' %}selected{% endif %}>Low</option>
            <option value="medium" {% if request.GET.priority == 'medium' %}selected{% endif %}>Medium</option>
            <option value="high" {% if request.GET.priority == 'high' %}selected{% endif %}>High</option>
            <option value="critical" {% if request.GET.priority == 'critical' %}selected{% endif %}>Critical</option>
        </select>
    </div>
    <div class="col-auto">
        <select name="status" class="form-select form-select-sm">
            <option value="">All Statuses</option>
            <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>Pending</option>
            <option value="in_progress" {% if request.GET.status == 'in_progress' %}selected{% endif %}>In Progress</option>
            <option value="resolved" {% if request.GET.status == 'resolved' %}selected{% endif %}>Resolved</option>
        </select>
    </div>
    <div class="col-auto"><button type="submit" class="btn btn-sm btn-primary">Filter</button></div>
</form>

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">All Issues</h5>
        <a href="{% url 'dashboard:export_reports' %}" class="btn btn-sm btn-outline-success">Export CSV</a>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Reporter</th>
                        <th>Assigned To</th>
                        <th>Date</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for issue in issues %}
                    <tr>
                        <td>{{ issue.title }}</td>
                        <td>{{ issue.get_category_display }}</td>
                        <td>{{ issue.get_priority_display }}</td>
                        <td><span class="badge status-{{ issue.status }}">{{ issue.get_status_display }}</span></td>
                        <td>{{ issue.reported_by.username }}</td>
                        <td>{{ issue.assigned_to.username|default:"â€”" }}</td>
                        <td>{{ issue.created_at|date:"M d" }}</td>
                        <td><a href="{% url 'issues:issue_detail' issue.pk %}" class="btn btn-sm btn-outline-primary">Manage</a></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="8" class="text-center text-muted py-4">No issues.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
